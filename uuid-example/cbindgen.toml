# cbindgen configuration for UUID library
language = "C"
include_guard = "CIMPL_UUID_H"
autogen_warning = "/* Warning, this file is autogenerated by cbindgen. Don't modify this manually. */"
documentation = true
documentation_style = "doxy"
line_length = 100
tab_width = 4
cpp_compat = true

# Add cimple_free declaration manually since it's from the parent crate
after_includes = """
// Opaque UUID type
typedef struct Uuid Uuid;

/**
 * @brief Universal free function for any pointer allocated by this library
 *
 * This function can free ANY pointer allocated and returned by functions in this
 * library, including:
 * - Uuid objects (returned by uuid_new_*, uuid_parse, etc.)
 * - Strings (returned by uuid_to_string, uuid_to_urn, etc.)
 * - Byte arrays (returned by uuid_as_bytes)
 *
 * @param ptr Pointer to free (can be NULL)
 * @return 0 on success, -1 on error (invalid pointer or double-free)
 *
 * @note Safe to call with NULL (returns 0)
 * @note Safe to call with any tracked pointer
 * @warning DO NOT call on pointers you allocated yourself from C
 * @warning Calling twice on the same pointer returns -1 (double-free protection)
 *
 * @par Example:
 * @code
 * Uuid* uuid = uuid_new_v4();
 * char* str = uuid_to_string(uuid);
 * 
 * cimple_free(str);   // Free the string
 * cimple_free(uuid);  // Free the UUID
 * @endcode
 */
int32_t cimple_free(void *ptr);

/* UUID-specific error codes (100+) */
extern const int32_t ERROR_UUID_PARSE_ERROR;
"""

header = """
/* Generated by cbindgen - DO NOT EDIT MANUALLY */

/**
 * @file cimpl_uuid.h
 * @brief UUID library demonstrating cimpl FFI patterns
 * 
 * This library provides safe UUID generation and manipulation using Rust's
 * uuid crate, exposed through a clean C API via cimpl.
 * 
 * @section features Features
 * 
 * - Generate UUID v4 (random) and v7 (timestamp-based)
 * - Parse UUIDs from strings
 * - Convert UUIDs to strings and bytes
 * - Compare and test UUIDs
 * - Thread-safe and memory-safe
 * 
 * @section error_convention Error Convention (Standard C Pattern)
 * 
 * This library follows standard C error conventions similar to errno.
 * 
 * **Return values indicate success or failure:**
 * - Pointer-returning functions: Return NULL on error
 * - Integer-returning functions: Return -1 on error, 0 on success
 * - Boolean-returning functions: Return false on error (use with caution)
 * 
 * **Error details are retrieved conditionally:**
 * Only check error code/message AFTER a function indicates failure.
 * 
 * @subsection error_functions Error Retrieval Functions
 * 
 * - uuid_error_code() - Get error type as integer (0 = no error)
 * - uuid_last_error() - Get error message string (must free with cimple_free)
 * - uuid_clear_error() - Clear the error state
 * 
 * @subsection error_example_c Error Handling Example (C)
 * 
 * @code{.c}
 * // Constructor returns NULL on error
 * Uuid* uuid = uuid_parse("invalid-uuid");
 * if (uuid == NULL) {
 *     // NOW check error details
 *     int32_t code = uuid_error_code();
 *     char* msg = uuid_last_error();
 *     fprintf(stderr, "Error %d: %s\\n", code, msg);
 *     cimple_free(msg);
 *     return -1;
 * }
 * @endcode
 * 
 * @section memory_management Memory Management
 * 
 * - UUIDs created with uuid_new_* or uuid_parse() must be freed with cimple_free()
 * - Strings returned by functions must be freed with cimple_free()
 * - Byte arrays returned must be freed with cimple_free()
 * - Passing NULL to cimple_free() is safe and will return success
 * - Double-free attempts are detected and return an error
 * 
 * @section thread_safety Thread Safety
 * 
 * All functions are thread-safe. UUID generation uses thread-local RNG state
 * for optimal performance.
 */
"""

[export]
exclude = ["Uuid"]  # Don't auto-generate, we define it manually

[enum]
rename_variants = "ScreamingSnakeCase"
prefix_with_name = true

[fn]
rename_args = "CamelCase"

[parse]
parse_deps = false
include = ["cimpl"]
