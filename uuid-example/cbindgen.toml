# cbindgen configuration for UUID library
# cbindgen configuration for cimpl-uuid example
#
# This demonstrates best practices for cimpl-generated C headers:
# - Universal `uuid_free()` for all allocations (no type-specific free functions)
# - Standard C error conventions (NULL = error for pointers, -1 for integers)
# - Error codes that map to exception classes in target languages
# - Comprehensive documentation that enables AI binding generation
# - Examples in multiple languages showing error handling patterns
#
# The generated header is designed to be consumed by:
# 1. C/C++ developers directly
# 2. FFI libraries (ctypes, Koffi, LuaJIT FFI, etc.)
# 3. AI code generators creating idiomatic language bindings
#
# Key lesson: When FFI tools have issues (like ffi-napi), the C API remains
# stable - just switch to a maintained alternative (like Koffi for Node.js).
#
# See ../DESIGN_GUIDE.md and ../LANGUAGE_BINDINGS.md for complete documentation.

language = "C"
include_guard = "CIMPL_UUID_H"
autogen_warning = "/* Warning, this file is autogenerated by cbindgen. Don't modify this manually. */"
documentation = true
documentation_style = "doxy"
line_length = 100
tab_width = 4
cpp_compat = true

# Add manual declarations for things cbindgen can't see
after_includes = """
// Opaque UUID type
typedef struct Uuid Uuid;
"""

header = """
/* Generated by cbindgen - DO NOT EDIT MANUALLY */

/**
 * @file cimpl_uuid.h
 * @brief UUID library demonstrating cimpl FFI patterns
 * 
 * This library provides safe UUID generation and manipulation using Rust's
 * uuid crate, exposed through a clean C API via cimpl.
 * 
 * @section features Features
 * 
 * - Generate UUID v4 (random) and v7 (timestamp-based)
 * - Parse UUIDs from strings
 * - Convert UUIDs to strings and bytes
 * - Compare and test UUIDs
 * - Thread-safe and memory-safe
 * 
 * @section error_convention Error Convention (Standard C Pattern)
 * 
 * This library follows standard C error conventions similar to errno.
 * 
 * **Return values indicate success or failure:**
 * - Pointer-returning functions: Return NULL on error
 * - Integer-returning functions: Return -1 on error, 0 on success
 * - Boolean-returning functions: Return false on error (use with caution)
 * 
 * **Error details are retrieved conditionally:**
 * Only check error code/message AFTER a function indicates failure.
 * 
 * @subsection error_functions Error Retrieval Functions
 * 
 * - uuid_error_code() - Get error type as integer (0 = no error)
 * - uuid_last_error() - Get error message string (must free with uuid_free)
 * - uuid_clear_error() - Clear the error state
 * 
 * @subsection error_example_c Error Handling Example (C)
 * 
 * @code{.c}
 * // Constructor returns NULL on error
 * Uuid* uuid = uuid_parse("invalid-uuid");
 * if (uuid == NULL) {
 *     // NOW check error details
 *     int32_t code = uuid_error_code();
 *     char* msg = uuid_last_error();
 *     fprintf(stderr, "Error %d: %s\\n", code, msg);
 *     uuid_free(msg);
 *     return -1;
 * }
 * @endcode
 * 
 * @section memory_management Memory Management
 * 
 * - UUIDs created with uuid_new_* or uuid_parse() must be freed with uuid_free()
 * - Strings returned by functions must be freed with uuid_free()
 * - Byte arrays returned must be freed with uuid_free()
 * - Passing NULL to uuid_free() is safe and will return success
 * - Double-free attempts are detected and return an error
 * 
 * @section thread_safety Thread Safety
 * 
 * All functions are thread-safe. UUID generation uses thread-local RNG state
 * for optimal performance.
 */
"""

[export]
exclude = ["Uuid"]  # Don't auto-generate, we define it manually

[enum]
rename_variants = "ScreamingSnakeCase"
prefix_with_name = true

[fn]
rename_args = "CamelCase"

[parse]
parse_deps = false
include = ["cimpl"]
